# /etc/tmpfiles.d/90-ghelper.conf
# G-Helper Linux — sysfs permissions for built-in kernel modules
#
# Problem: udev rules can't fire for built-in kernel modules (they're loaded
# before udev starts). This tmpfiles config runs at every boot via
# systemd-tmpfiles-setup.service to set permissions on sysfs nodes
# that udev rules may miss.
#
# The 'z' directive sets permissions only if the path exists — safe for
# systems that don't have a particular hardware feature.
#
# This complements (not replaces) the udev rules in 90-ghelper.rules.
# Belt-and-suspenders: udev handles modular drivers, tmpfiles catches built-in.

# ── CPU boost ──
# Intel pstate (often built-in on modern kernels)
z /sys/devices/system/cpu/intel_pstate/no_turbo 0666 - - -

# AMD / generic cpufreq boost
z /sys/devices/system/cpu/cpufreq/boost 0666 - - -

# ── ACPI platform profile ──
# Controls balanced/performance/low-power mode switching
z /sys/firmware/acpi/platform_profile 0666 - - -

# ── PCIe ASPM policy ──
# May still be kernel-enforced read-only on some systems
z /sys/module/pcie_aspm/parameters/policy 0666 - - -

# ── Battery charge limit ──
# Needs to be writable before user login so G-Helper can re-apply saved limit
z /sys/class/power_supply/BAT0/charge_control_end_threshold 0666 - - -
z /sys/class/power_supply/BAT1/charge_control_end_threshold 0666 - - -
z /sys/class/power_supply/BATT/charge_control_end_threshold 0666 - - -

# ── ASUS WMI platform attributes ──
# These may be built-in on some distributions
z /sys/devices/platform/asus-nb-wmi/throttle_thermal_policy 0666 - - -
z /sys/devices/platform/asus-nb-wmi/panel_od 0666 - - -
z /sys/devices/platform/asus-nb-wmi/ppt_pl1_spl 0666 - - -
z /sys/devices/platform/asus-nb-wmi/ppt_pl2_sppt 0666 - - -
z /sys/devices/platform/asus-nb-wmi/ppt_fppt 0666 - - -
z /sys/devices/platform/asus-nb-wmi/nv_dynamic_boost 0666 - - -
z /sys/devices/platform/asus-nb-wmi/nv_temp_target 0666 - - -
z /sys/bus/platform/devices/asus-nb-wmi/dgpu_disable 0666 - - -
z /sys/bus/platform/devices/asus-nb-wmi/gpu_mux_mode 0666 - - -
z /sys/bus/platform/devices/asus-nb-wmi/mini_led_mode 0666 - - -

# ── ASUS firmware-attributes (asus-armoury ──
# On newer kernels, legacy asus-nb-wmi sysfs attributes are replaced by
# firmware-attributes under /sys/class/firmware-attributes/asus-armoury/.
# The 'z' directive is safe — it does nothing if the path doesn't exist.
z /sys/class/firmware-attributes/asus-armoury/attributes/throttle_thermal_policy/current_value 0666 - - -
z /sys/class/firmware-attributes/asus-armoury/attributes/dgpu_disable/current_value 0666 - - -
z /sys/class/firmware-attributes/asus-armoury/attributes/gpu_mux_mode/current_value 0666 - - -
z /sys/class/firmware-attributes/asus-armoury/attributes/panel_od/current_value 0666 - - -
z /sys/class/firmware-attributes/asus-armoury/attributes/panel_overdrive/current_value 0666 - - -
z /sys/class/firmware-attributes/asus-armoury/attributes/mini_led_mode/current_value 0666 - - -
z /sys/class/firmware-attributes/asus-armoury/attributes/ppt_pl1_spl/current_value 0666 - - -
z /sys/class/firmware-attributes/asus-armoury/attributes/ppt_pl2_sppt/current_value 0666 - - -
z /sys/class/firmware-attributes/asus-armoury/attributes/ppt_fppt/current_value 0666 - - -
z /sys/class/firmware-attributes/asus-armoury/attributes/nv_dynamic_boost/current_value 0666 - - -
z /sys/class/firmware-attributes/asus-armoury/attributes/nv_temp_target/current_value 0666 - - -

# ── Keyboard backlight ──
z /sys/class/leds/asus::kbd_backlight/brightness 0666 - - -
z /sys/class/leds/asus::kbd_backlight/multi_intensity 0666 - - -
z /sys/class/leds/asus::kbd_backlight/kbd_rgb_mode 0666 - - -
z /sys/class/leds/asus::kbd_backlight/kbd_rgb_state 0666 - - -
